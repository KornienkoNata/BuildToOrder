//Автоматическое заполнение "Заказа на сборку" на основании "Заказа клиента".
//Форма документа "Заказ на сборку"

Процедура ЗаполнитьПоЗаказуКлиента(ЗаказКлиента)

	Запрос = Новый Запрос( 
	"ВЫБРАТЬ
	|	ЗаказКлиентаТовары.Номенклатура,
	|	ЗаказКлиентаТовары.Ссылка,
	|	ЗаказКлиентаТовары.Количество
	|ПОМЕСТИТЬ НаименованиеНоменклатуры
	|ИЗ
	|	Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
	|ГДЕ
	|	ЗаказКлиентаТовары.Ссылка = &ЗаказКлиента
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НаименованиеНоменклатуры.Номенклатура,
	|	ЗаказКлиента.Проведен КАК Проведен,
	|	ЗаказКлиента.Организация,
	|	ЗаказКлиента.Статус КАК СтатусДокумента,
	|	ЗаказКлиента.Склад КАК СкладДокумента,
	|	ЗаказКлиента.Сделка,
	|	ЗаказКлиента.Склад.ЭтоГруппа КАК ЭтоГруппа,
	|	ЗаказКлиента.Подразделение,
	|	ВЫБОР
	|		КОГДА ЗаказКлиента.Статус В (ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.НеСогласован))
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЕстьОшибкиСтатус,
	|	НаименованиеНоменклатуры.Количество
	|ИЗ
	|	НаименованиеНоменклатуры КАК НаименованиеНоменклатуры
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента КАК ЗаказКлиента
	|		ПО НаименованиеНоменклатуры.Ссылка = ЗаказКлиента.Ссылка");
	
	Запрос.УстановитьПараметр("ЗаказКлиента", ЗаказКлиента);
	Реквизиты = Запрос.Выполнить().Выбрать();
	Реквизиты.Следующий();

	МассивДопустимыхСтатусов = Новый Массив;
	МассивДопустимыхСтатусов.Добавить(Перечисления.СтатусыЗаказовКлиентов.Согласован);
	МассивДопустимыхСтатусов.Добавить(Перечисления.СтатусыЗаказовКлиентов.КОбеспечению);
	МассивДопустимыхСтатусов.Добавить(Перечисления.СтатусыЗаказовКлиентов.КОтгрузке);
	МассивДопустимыхСтатусов.Добавить(Перечисления.СтатусыЗаказовКлиентов.Закрыт);
	
	ОбщегоНазначенияУТ.ПроверитьВозможностьВводаНаОсновании(
		ЗаказКлиента,
		Реквизиты.СтатусДокумента,
		НЕ Реквизиты.Проведен,
		Реквизиты.ЕстьОшибкиСтатус,
		МассивДопустимыхСтатусов);
	
	//Заполнение шапки
	Организация       = Реквизиты.Организация;
	Сделка            = Реквизиты.Сделка;
	ДокументОснование = ЗаказКлиента;
	Подразделение     = Реквизиты.Подразделение;
 	Склад = Реквизиты.СкладДокумента;
	ТаблицаТовары = Документы.ЗаказКлиента.ТаблицаНеобеспеченнойПотребности(ЗаказКлиента);
	Номенклатура =  Реквизиты.Номенклатура;
	КоличествоУпаковок = Реквизиты.Количество;
	ВариантКомплектации = Справочники.ВариантыКомплектацииНоменклатуры.НайтиПоНаименованию(Реквизиты.Номенклатура);	
	
	 	
//	Запрос = Новый Запрос;
//	Запрос.Текст = 
//		"ВЫБРАТЬ
//		|	ВариантыКомплектацииНоменклатурыТовары.Номенклатура,
//		|	ВариантыКомплектацииНоменклатурыТовары.Количество,
//		|	ВариантыКомплектацииНоменклатурыТовары.Ссылка.Ссылка
//		|ИЗ
//		|	Справочник.ВариантыКомплектацииНоменклатуры.Товары КАК ВариантыКомплектацииНоменклатурыТовары
//		|ГДЕ
//		|	ВариантыКомплектацииНоменклатурыТовары.Ссылка = &Ссылка";
//	
//	Запрос.УстановитьПараметр("Ссылка", ВариантКомплектации);
//	
//	РезультатЗапроса = Запрос.Выполнить();
//	
//	Выборка = РезультатЗапроса.Выбрать(); //тут получили комплектацию объекта для сборки
////	МойДокумент = ЭтотОбъект.Ссылка.ПолучитьФорму("ФормаДокумента"); 
//	
//	Пока Выборка.Следующий() Цикл
//		//Форма.Элементы.Товары.ТоварыНоменклатура = Выборка.Номенклатура;
//		//Форма.Элементы.Товары.ТоварыКоличествоУпаковок = Выборка.Количество;
//	КонецЦикла;
	


	
	
	//Тут заполнить таблицу комплектующими
	Если ТаблицаТовары.Количество() > 0 Тогда

		ЗаполнитьЗначенияСвойств(ЭтотОбъект, ТаблицаТовары[0]);
		//Товары.Загрузить(ТаблицаТовары);
		//СкладПолучатель = ТаблицаТовары[0].Склад;

	КонецЕсли;

КонецПроцедуры
