//Автоматическое заполнение "Заказа на сборку" на основании "Заказа клиента".
//Форма документа "Заказ на сборку"

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	МенеджерОборудованияКлиент.ПодключитьОборудованиеПриОткрытииФормы(ЭтаФорма, "СканерШтрихкода");
	
	НоменклатураКлиент.ОбновитьКешированныеЗначенияШапкиДляУчетаСерий(Объект,КэшированныеЗначения,ПараметрыУказанияСерий.Шапка);	
	
	//Если шапка не заполнена, то документ вводился не на основании, либо комлектация не нашлась.
	Если ЗначениеЗаполнено(Объект.ВариантКомплектации) Тогда
		ЗаполнениеТаблицыНаСервере();
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ЗаполнениеТаблицыНаСервере();	
		
	
	ДокОбъект = РеквизитФормыВЗначение("Объект");			
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ВариантыКомплектацииНоменклатурыТовары.Номенклатура,
		|	ВариантыКомплектацииНоменклатурыТовары.Количество * &КоличествоОбъектов КАК КоличествоУпаковок,
		|	ВариантыКомплектацииНоменклатурыТовары.Ссылка
		|ИЗ
		|	Справочник.ВариантыКомплектацииНоменклатуры.Товары КАК ВариантыКомплектацииНоменклатурыТовары
		|ГДЕ
		|	ВариантыКомплектацииНоменклатурыТовары.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("КоличествоОбъектов", Объект.КоличествоУпаковок);		
	Запрос.УстановитьПараметр("Ссылка", Объект.ВариантКомплектации);		
	ДокОбъект.Товары.Загрузить(Запрос.Выполнить().Выгрузить());	
	ЗначениеВРеквизитФормы(ДокОбъект, "Объект");		
	
КонецПроцедуры
